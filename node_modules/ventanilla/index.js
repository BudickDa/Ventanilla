var modules = {};
/*
* Initilize hardware
* Input: config is a dynamicly generated file. It contains:
* - which boards shall be included and what ports do they have
*/
exports.init = function(cb){
  if(module_exists('ventanilla-arduino')){
    modules.arduino = require('ventanilla-arduino');
  }
}



/*Arduino*/
function registerArduinoBoard(block,cb){
  if(module_exists('ventanilla-arduino')){
    modules.arduino = require('ventanilla-arduino');
    //todo: make more than one board available
    modules.arduino.init('/dev/ttyACM0',function(board){
      //for debug reasons there is only one board on index 2
      hardware.blocks[2]=board;
      return cb(hardware);
    });
  }
  else{
    return cb(hardware);
  }
}


/*Helper*/
var module_exists = function(name){
  try {return require.resolve(name)}
  catch(e){return false}
}

exports.registerBlock = function(block,cb){

  var uid = block.uid;

  if(block.system === "arduino")
    if(modules.arduino !== undefined){

      if(block.type === "Sensor"){
        console.log("Register Sensor on ArduinoBoard "+block.input[0]);
        modules.arduino.registerSensor(block,cb);

      } else if(block.type === "ArduinoUno"){
        console.log("Register Arduino Board  Uno");
        modules.arduino.init('/dev/ttyACM0',function(board){
          board.id = uid;
          return cb(board)
        });
      }

    }else{
      console.log("Modules: Arduinomodule is not available.")
    }
}



