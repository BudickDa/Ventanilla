var modules = {};
/*
* Initilize hardware
* Input: config is a dynamicly generated file. It contains:
* - which boards shall be included and what ports do they have
*/
exports.init = function(cb){
  /*this object contains the whole supported hardware*/
  var hardware = {};
  hardware.blocks = [];
  /*Initilize Arduinosupport*/
  tryArduino(hardware,function(hardware){
    //todo init the other stuff...
    return cb(hardware);
  });
}


/*Try different hardware types*/
/*Arduino*/
function tryArduino(hardware,cb){
  if(module_exists('ventanilla-arduino')){
    modules.arduino = require('ventanilla-arduino');
    //todo: make more than one board available
    modules.arduino.init('/dev/ttyACM0',function(board){
      //for debug reasons there is only one board on index 2
      hardware.blocks[2]=board;
      return cb(hardware);
    });
  }
  else{
    return cb(hardware);
  }
}


/*Helper*/
var module_exists = function(name){
  try {return require.resolve(name)}
  catch(e){return false}
}
exports.registerSensor = function(hardware,block,cb){
  if(modules.arduino !== undefined){
    console.log("Register Sensor on Arduinoboard "+block.input[0]);
    modules.arduino.registerSensor(hardware,block,block.input[0],cb);
  }else{
    console.log("Modules: Arduinomodule is not available.")
  }
}



