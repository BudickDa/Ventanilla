/*
* Initilize hardware
* Input: config is a dynamicly generated file. It contains:
* - which boards shall be included and what ports do they have
*/
exports.initHardware = function(config, cb){
  /*Initilize Arduinosupport*/
  var hardware = {};
  tryArduino(config, hardware, function(hardware){
    //todo init the other stuff...
    return cb(hardware);
  });
}


/*Try different hardware types*/
/*Arduino*/
function tryArduino(config, hardware, cb){
  if(module_exists('ventanilla-arduino')){
    var arduino = require('ventanilla-arduino');
    hardware.arduinoBoards = [];
    for(var i=0;i<config.arduinoBoards.length;i++){
      var configBoard = config.arduinoBoards[i];
      arduino.init(configBoard, function(board){
        hardware.arduinoBoards.push(board);
        //if length of boards in hardware is equal to length of boards in config we can move on
        if(hardware.arduinoBoards.length === config.arduinoBoards.length){
          board = {};
          return cb(hardware);
        }
      });
    }

  }
  else{
    return cb(hardware);
  }
}


/*Helper*/
function module_exists( name ) {
  try { return require.resolve( name ) }
  catch( e ) { return false }
}




