var modules = {};
/*
* Initilize hardware
* Input: config is a dynamicly generated file. It contains:
* - which boards shall be included and what ports do they have
*/
exports.init = function(cb){
  /*this object contains the whole supported hardware*/
  var hardware = {};
  /*Initilize Arduinosupport*/
  tryArduino(hardware,function(hardware){
    //todo init the other stuff...
    return cb(hardware);
  });
}


/*Try different hardware types*/
/*Arduino*/
function tryArduino(hardware,cb){
  if(module_exists('ventanilla-arduino')){
    modules.arduino = require('ventanilla-arduino');
    hardware.arduinoBoards = [];
    //todo: make more than one board available
    modules.arduino.init('/dev/ttyACM0',function(board){
      hardware.arduinoBoards.push(board);
      return cb(hardware);
    });
  }
  else{
    return cb(hardware);
  }
}


/*Helper*/
var module_exists = function(name){
  try {return require.resolve(name)}
  catch(e){return false}
}
exports.registerSensor = function(hardware,interface,sensor,cb){
  if(interface.type==="arduino"){
    if(modules.arduino !== undefined){
      console.log("Register Sensor on Arduinoboard "+interface.uid);
      modules.arduino.registerSensor(hardware,interface,sensor,cb);
    }else{
      console.log("Modules: Arduinomodule is not available.")
    }
  }
  else{
    console.log("Interface: Type is undefined!");
  }
}



